{
	"name": "aEnemy ðŸ˜ˆ",
	"events": [
		{
			"aceType": "action",
			"aceName": "spawnFromQueue",
			"objectClass": "Enemy",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "custom-ace-block",
			"conditions": [
				{
					"id": "compare-value",
					"objectClass": "Rules",
					"sid": 416384875828382,
					"parameters": {
						"path": "KEY_Queues & DOT & KEY_Enemies",
						"cmp": 4,
						"value": "0"
					}
				}
			],
			"actions": [
				{
					"type": "comment",
					"text": "Process enemy spawn queue, spawn one enemy per call (tick) and remove it from the queue"
				},
				{
					"id": "subtract-from",
					"objectClass": "Rules",
					"sid": 259101572361751,
					"parameters": {
						"path": "KEY_Queues & DOT & KEY_Enemies",
						"value": "1"
					}
				},
				{
					"id": "set-eventvar-value",
					"objectClass": "System",
					"sid": 361829937226822,
					"parameters": {
						"variable": "randomAngle",
						"value": "random(0, 360)"
					}
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 443287625595748,
					"parameters": {
						"object-to-create": "Enemy",
						"layer": "LAYER_Main",
						"x": "Player.X + cos(randomAngle) * Rules.Get(KEY_Spawns & DOT & KEY_Enemies & DOT & KEY_Distance)",
						"y": "Player.Y + sin(randomAngle) * Rules.Get(KEY_Spawns & DOT & KEY_Enemies & DOT & KEY_Distance)",
						"create-hierarchy": true,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-animation",
					"objectClass": "Enemy",
					"sid": 188179399128604,
					"parameters": {
						"animation": "AdvancedRandom.WeightedByName(PT_Enemies)",
						"from": "beginning"
					}
				},
				{
					"id": "set-instvar-value",
					"objectClass": "Enemy",
					"sid": 736865178929334,
					"parameters": {
						"instance-variable": "health",
						"value": "Rules.Get(KEY_Enemies & DOT & Enemy.AnimationName & DOT & KEY_Health)"
					}
				},
				{
					"id": "set-instvar-value",
					"objectClass": "Enemy",
					"sid": 639507967605963,
					"parameters": {
						"instance-variable": "damage",
						"value": "Rules.Get(KEY_Enemies & DOT & Enemy.AnimationName & DOT & KEY_Damage)"
					}
				},
				{
					"id": "set-instvar-value",
					"objectClass": "Enemy",
					"sid": 903127641605562,
					"parameters": {
						"instance-variable": "experience",
						"value": "Rules.Get(KEY_Enemies & DOT & Enemy.AnimationName & DOT & KEY_Experience)"
					}
				}
			],
			"sid": 418646961252127
		},
		{
			"aceType": "action",
			"aceName": "tick",
			"objectClass": "Enemy",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionCopyPicked": false,
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "custom-ace-block",
			"conditions": [
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 759310124208695,
					"parameters": {
						"variable": "isLeveling",
						"comparison": 0,
						"value": "NO"
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "Enemy",
					"sid": 169438741384102,
					"parameters": {
						"instance-variable": "isDead",
						"comparison": 0,
						"value": "NO"
					}
				},
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 356892487029801,
					"parameters": {
						"variable": "isPaused",
						"comparison": 0,
						"value": "NO"
					}
				}
			],
			"actions": [
				{
					"type": "comment",
					"text": "Reset \"movement blocked\" state"
				},
				{
					"id": "set-instvar-value",
					"objectClass": "Enemy",
					"sid": 102457041612568,
					"parameters": {
						"instance-variable": "isMovementBlocked",
						"value": "NO"
					}
				}
			],
			"sid": 323244324797060,
			"children": [
				{
					"eventType": "comment",
					"text": "Enemy getting damaged"
				},
				{
					"bookmark": true,
					"eventType": "block",
					"conditions": [
						{
							"id": "is-overlapping-another-object",
							"objectClass": "Enemy",
							"sid": 807314407853475,
							"parameters": {
								"object": "Weapon"
							}
						},
						{
							"id": "is-on-screen",
							"objectClass": "Weapon",
							"sid": 250565518753538
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "Weapon",
							"sid": 682851023232220,
							"parameters": {
								"instance-variable": "isDestroyed",
								"comparison": 0,
								"value": "NO"
							}
						}
					],
					"actions": [
						{
							"type": "comment",
							"text": "Set movement block if needed"
						},
						{
							"type": "comment",
							"text": "todo_now"
						},
						{
							"id": "set-instvar-value",
							"objectClass": "Enemy",
							"sid": 393868468966729,
							"parameters": {
								"instance-variable": "isMovementBlocked",
								"value": "KEY_Weapons & DOT & Weapon.AnimationName & DOT & KEY_BlockMovement"
							}
						},
						{
							"type": "comment",
							"text": "Damage enemy"
						},
						{
							"id": "subtract-from-instvar",
							"objectClass": "Enemy",
							"sid": 953437095812154,
							"parameters": {
								"instance-variable": "health",
								"value": "Weapon.damage * dt * Rules.Get(KEY_Player & DOT & KEY_Bonus_Weapon_Damage_Multiplier)"
							}
						},
						{
							"id": "add-to-instvar",
							"objectClass": "Enemy",
							"sid": 339039127435682,
							"parameters": {
								"instance-variable": "damageNumber",
								"value": "Weapon.damage * dt * Rules.Get(KEY_Player & DOT & KEY_Bonus_Weapon_Damage_Multiplier)"
							}
						},
						{
							"type": "comment",
							"text": "Show damage flash"
						},
						{
							"id": "set-default-color",
							"objectClass": "Enemy",
							"sid": 485879420803582,
							"parameters": {
								"color": "rgbEx(500, 500, 500)"
							}
						},
						{
							"type": "comment",
							"text": "If projectile pierced a new enemy, add it to the list"
						},
						{
							"id": "set-instvar-value",
							"objectClass": "Weapon",
							"sid": 589144911077692,
							"parameters": {
								"instance-variable": "piercedUIDs_SSV",
								"value": "find(SPACE & Self.piercedUIDs_SSV & SPACE, str(Enemy.UID)) = NOTHING ? Self.piercedUIDs_SSV & SPACE & Enemy.UID : Self.piercedUIDs_SSV"
							}
						}
					],
					"sid": 465104577973746,
					"children": [
						{
							"eventType": "comment",
							"text": "Check projectile piercing limit & destroy projectile if reached"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "for-each",
									"objectClass": "System",
									"sid": 429591461669344,
									"parameters": {
										"object": "Weapon"
									}
								},
								{
									"id": "pick-by-comparison",
									"objectClass": "System",
									"sid": 995038679006034,
									"parameters": {
										"object": "Weapon",
										"expression": "tokencount(trim(Weapon.piercedUIDs_SSV), SPACE)",
										"comparison": 5,
										"value": "Rules.Get(KEY_Weapons & DOT & Weapon.AnimationName & DOT & KEY_PierceLimit)"
									}
								}
							],
							"actions": [
								{
									"id": "log",
									"objectClass": "Browser",
									"sid": 988057123335795,
									"parameters": {
										"type": "log",
										"message": "\"Projectile #\" & Weapon.UID & \" has pierced \" & tokencount(trim(Weapon.piercedUIDs_SSV), SPACE) & \" enemies, destroying.\""
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "Weapon",
									"sid": 151100235435201,
									"parameters": {
										"instance-variable": "isDestroyed",
										"value": "YES"
									}
								},
								{
									"type": "comment",
									"text": "todo tween etc"
								},
								{
									"id": "destroy",
									"objectClass": "Weapon",
									"sid": 452669270812600
								}
							],
							"sid": 728908823243223
						},
						{
							"eventType": "comment",
							"text": "Show damage number if needed"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "Enemy",
									"sid": 152429532726828,
									"parameters": {
										"instance-variable": "damageNumber",
										"comparison": 5,
										"value": "1"
									}
								},
								{
									"id": "has-children",
									"objectClass": "Enemy",
									"sid": 141796681604622,
									"isInverted": true
								}
							],
							"actions": [
								{
									"customAction": "playSFX",
									"objectClass": "Audio",
									"sid": 746673726225653,
									"parameters": [
										"SFX_EnemyDamaged",
										"3",
										"1"
									]
								},
								{
									"id": "spawn-another-object",
									"objectClass": "Enemy",
									"sid": 784961018944364,
									"parameters": {
										"object": "UI_TextSF_DamageNumber",
										"layer": "Enemy.LayerName",
										"image-point": "IP_Enemy_DamageNumber",
										"create-hierarchy": false,
										"template-name": "\"\""
									}
								},
								{
									"type": "comment",
									"text": "todo bugfix: zero out damage taken after text is spawned"
								},
								{
									"id": "set-x",
									"objectClass": "UI_TextSF_DamageNumber",
									"sid": 380455576936530,
									"parameters": {
										"x": "Self.X + 1"
									}
								},
								{
									"id": "add-child",
									"objectClass": "Enemy",
									"sid": 697475773580818,
									"parameters": {
										"child": "UI_TextSF_DamageNumber",
										"transform-x": false,
										"transform-y": false,
										"transform-w": false,
										"transform-h": false,
										"transform-a": false,
										"transform-o": false,
										"transform-z-elevation": false,
										"transform-visibility": false,
										"destroy-with-parent": true
									}
								},
								{
									"id": "tween-two-properties",
									"objectClass": "UI_TextSF_DamageNumber",
									"sid": 242393952289136,
									"behaviorType": "Tween",
									"parameters": {
										"tags": "\"\"",
										"property": "position",
										"end-x": "Self.X + cos(angle(0, 0, Enemy.Physics.VelocityX, Enemy.Physics.VelocityY) + 180) * 10",
										"end-y": "Self.Y + sin(angle(0, 0, Enemy.Physics.VelocityX, Enemy.Physics.VelocityY) + 180) * 10",
										"time": "0.5",
										"ease": "easeoutcubic",
										"destroy-on-complete": "no",
										"loop": "no",
										"ping-pong": "no",
										"repeat-count": "1"
									}
								},
								{
									"id": "tween-one-property",
									"objectClass": "UI_TextSF_DamageNumber",
									"sid": 995825742636294,
									"behaviorType": "Tween",
									"parameters": {
										"tags": "\"\"",
										"property": "offsetOpacity",
										"end-value": "0",
										"time": "0.5",
										"ease": "easeinexpo",
										"destroy-on-complete": "yes",
										"loop": "no",
										"ping-pong": "no",
										"repeat-count": "1"
									}
								},
								{
									"id": "set-visible",
									"objectClass": "UI_TextSF_DamageNumber",
									"sid": 435503946897832,
									"parameters": {
										"visibility": "visible"
									}
								},
								{
									"id": "set-text",
									"objectClass": "UI_TextSF_DamageNumber",
									"sid": 676689008390364,
									"parameters": {
										"text": "round(Enemy.damageNumber)"
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "Enemy",
									"sid": 628033003207604,
									"parameters": {
										"instance-variable": "damageNumber",
										"value": "0"
									}
								}
							],
							"sid": 768998235732742
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-instance-variable",
									"objectClass": "Enemy",
									"sid": 404823882277430,
									"parameters": {
										"instance-variable": "health",
										"comparison": 3,
										"value": "0"
									}
								}
							],
							"actions": [
								{
									"id": "set-instvar-value",
									"objectClass": "Enemy",
									"sid": 402986492608939,
									"parameters": {
										"instance-variable": "isDead",
										"value": "YES"
									}
								},
								{
									"id": "set-enabled",
									"objectClass": "Enemy",
									"sid": 228016190127938,
									"behaviorType": "Physics",
									"parameters": {
										"mode": "disabled"
									}
								},
								{
									"id": "tween-one-property",
									"objectClass": "Enemy",
									"sid": 331735849961764,
									"behaviorType": "Tween",
									"parameters": {
										"tags": "\"\"",
										"property": "offsetOpacity",
										"end-value": "0",
										"time": "0.5",
										"ease": "easeinoutcubic",
										"destroy-on-complete": "yes",
										"loop": "no",
										"ping-pong": "no",
										"repeat-count": "1"
									}
								},
								{
									"id": "spawn-another-object",
									"objectClass": "Enemy",
									"sid": 304212795716647,
									"parameters": {
										"object": "Drop",
										"layer": "LAYER_Main",
										"image-point": "0",
										"create-hierarchy": false,
										"template-name": "\"\""
									}
								},
								{
									"id": "set-instvar-value",
									"objectClass": "Drop",
									"sid": 131233287870206,
									"parameters": {
										"instance-variable": "amount",
										"value": "Enemy.experience"
									}
								}
							],
							"sid": 158259314566033,
							"children": [
								{
									"bookmark": true,
									"eventType": "comment",
									"text": "Spawn an item from the queue (if enemy is far enough from the player and within layout bounds)"
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 400710386844605,
											"parameters": {
												"first-value": "Rules.ArraySize(KEY_Queues & DOT & KEY_Items)",
												"comparison": 4,
												"second-value": "0"
											}
										},
										{
											"id": "is-overlapping-another-object",
											"objectClass": "Enemy",
											"sid": 238260535279451,
											"parameters": {
												"object": "Item"
											},
											"isInverted": true
										},
										{
											"id": "is-outside-layout",
											"objectClass": "Enemy",
											"sid": 498433608917396,
											"isInverted": true
										},
										{
											"id": "pick-by-comparison",
											"objectClass": "System",
											"sid": 363693118836054,
											"parameters": {
												"object": "Enemy",
												"expression": "distance(Enemy.X, Enemy.Y, Player.X, Player.Y)",
												"comparison": 5,
												"value": "C_Item_Spawn_Distance_Min"
											}
										}
									],
									"actions": [
										{
											"id": "create-object",
											"objectClass": "System",
											"sid": 427850262955858,
											"parameters": {
												"object-to-create": "Item",
												"layer": "LAYER_Main",
												"x": "Enemy.X",
												"y": "Enemy.Y",
												"create-hierarchy": true,
												"template-name": "\"\""
											}
										},
										{
											"type": "comment",
											"text": "Set upgrade"
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Item",
											"sid": 597701673707448,
											"parameters": {
												"instance-variable": "upgrade",
												"value": "Rules.Get(KEY_Queues & DOT & KEY_Items & DOT & 0)"
											}
										},
										{
											"id": "log",
											"objectClass": "Browser",
											"sid": 217617026861100,
											"parameters": {
												"type": "log",
												"message": "\"spawning item: \" & Item.upgrade"
											}
										},
										{
											"type": "comment",
											"text": "Spawn icon"
										},
										{
											"id": "spawn-another-object",
											"objectClass": "Item",
											"sid": 574624985699913,
											"parameters": {
												"object": "Icon",
												"layer": "LAYER_Main",
												"image-point": "0",
												"create-hierarchy": false,
												"template-name": "\"\""
											}
										},
										{
											"id": "add-child",
											"objectClass": "Item",
											"sid": 198627867679643,
											"parameters": {
												"child": "Icon",
												"transform-x": true,
												"transform-y": true,
												"transform-w": true,
												"transform-h": true,
												"transform-a": true,
												"transform-o": true,
												"transform-z-elevation": false,
												"transform-visibility": true,
												"destroy-with-parent": true
											}
										},
										{
											"type": "comment",
											"text": "Start tween to fade out item before next spawn"
										},
										{
											"id": "log",
											"objectClass": "Browser",
											"sid": 730733740712829,
											"parameters": {
												"type": "log",
												"message": "\"setting icon: \" & Rules.Get(KEY_Upgrades & DOT & Item.upgrade & DOT & KEY_Icon)"
											}
										},
										{
											"id": "set-animation",
											"objectClass": "Icon",
											"sid": 793804274910788,
											"parameters": {
												"animation": "Rules.Get(KEY_Upgrades & DOT & Item.upgrade & DOT & KEY_Icon)",
												"from": "beginning"
											}
										},
										{
											"type": "comment",
											"text": "Spawn & initialize arrow"
										},
										{
											"id": "spawn-another-object",
											"objectClass": "Player",
											"sid": 680771256286622,
											"parameters": {
												"object": "Arrow",
												"layer": "LAYER_Main",
												"image-point": "0",
												"create-hierarchy": false,
												"template-name": "\"\""
											}
										},
										{
											"id": "add-child",
											"objectClass": "Item",
											"sid": 959138659302353,
											"parameters": {
												"child": "Arrow",
												"transform-x": false,
												"transform-y": false,
												"transform-w": false,
												"transform-h": false,
												"transform-a": false,
												"transform-o": false,
												"transform-z-elevation": false,
												"transform-visibility": false,
												"destroy-with-parent": true
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Arrow",
											"sid": 791621165867173,
											"parameters": {
												"instance-variable": "itemX",
												"value": "Item.X"
											}
										},
										{
											"id": "set-instvar-value",
											"objectClass": "Arrow",
											"sid": 384880148953013,
											"parameters": {
												"instance-variable": "itemY",
												"value": "Item.Y"
											}
										},
										{
											"id": "set-opacity",
											"objectClass": "Arrow",
											"sid": 296270546148280,
											"parameters": {
												"opacity": "0"
											}
										},
										{
											"type": "comment",
											"text": "Remove spawned item from queue"
										},
										{
											"id": "pop-value",
											"objectClass": "Rules",
											"sid": 502417958839213,
											"parameters": {
												"where": "front",
												"path": "KEY_Queues & DOT & KEY_Items"
											}
										}
									],
									"sid": 129191214035208
								}
							]
						}
					]
				},
				{
					"eventType": "comment",
					"text": "Move enemies that are not blocked by the weapon"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "is-overlapping-another-object",
							"objectClass": "Enemy",
							"sid": 446909647721359,
							"parameters": {
								"object": "Weapon"
							},
							"isInverted": true
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "Enemy",
							"sid": 795640150955139,
							"parameters": {
								"instance-variable": "isMovementBlocked",
								"comparison": 0,
								"value": "NO"
							}
						}
					],
					"actions": [
						{
							"id": "apply-force-towards-position",
							"objectClass": "Enemy",
							"sid": 309384909754023,
							"behaviorType": "Physics",
							"parameters": {
								"force": "Rules.Get(KEY_Enemies & DOT & Enemy.AnimationName & DOT & KEY_MovementSpeed)",
								"x": "Player.X",
								"y": "Player.Y",
								"image-point": "0"
							}
						},
						{
							"type": "comment",
							"text": "todo set linear damping after setting speed?"
						},
						{
							"id": "set-default-color",
							"objectClass": "Enemy",
							"sid": 928884212976278,
							"parameters": {
								"color": "rgbEx(100, 100, 100)"
							}
						}
					],
					"sid": 403949667641976
				},
				{
					"eventType": "comment",
					"text": "Mirror enemies based on their position relative to the player"
				},
				{
					"eventType": "comment",
					"text": "todo_pack maybe some foreach based ugly business instead"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-x",
							"objectClass": "Enemy",
							"sid": 127593178964393,
							"parameters": {
								"comparison": 4,
								"x-co-ordinate": "Player.X + C_Enemy_Mirror_Threshold"
							}
						}
					],
					"actions": [
						{
							"id": "set-mirrored",
							"objectClass": "Enemy",
							"sid": 629899684839711,
							"parameters": {
								"state": "mirrored"
							}
						}
					],
					"sid": 304448305740616
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-x",
							"objectClass": "Enemy",
							"sid": 333258971427132,
							"parameters": {
								"comparison": 2,
								"x-co-ordinate": "Player.X - C_Enemy_Mirror_Threshold"
							}
						}
					],
					"actions": [
						{
							"id": "set-mirrored",
							"objectClass": "Enemy",
							"sid": 720267318350729,
							"parameters": {
								"state": "not-mirrored"
							}
						}
					],
					"sid": 894429956563491
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "Enemy",
							"sid": 222801899404332,
							"parameters": {
								"instance-variable": "isMovementBlocked",
								"comparison": 0,
								"value": "YES"
							}
						}
					],
					"actions": [
						{
							"id": "log",
							"objectClass": "Browser",
							"sid": 218060331233019,
							"parameters": {
								"type": "log",
								"message": "\"Enemies with movement blocked: \" & Enemy.PickedCount"
							}
						}
					],
					"sid": 250292561153445
				}
			]
		}
	],
	"sid": 389141576528271
}