{
	"name": "eSystem ⏱️",
	"events": [
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-start-of-layout",
					"objectClass": "System",
					"sid": 973691923966273
				}
			],
			"actions": [
				{
					"type": "comment",
					"text": "Move editor to UI layer & hide it by default"
				},
				{
					"id": "move-to-layer",
					"objectClass": "Editor",
					"sid": 328131485641796,
					"parameters": {
						"layer": "LAYER_UI"
					}
				},
				{
					"id": "set-visible",
					"objectClass": "Editor",
					"sid": 746445835537442,
					"parameters": {
						"visibility": "invisible"
					}
				},
				{
					"type": "comment",
					"text": "Load rules"
				},
				{
					"type": "script",
					"language": "javascript",
					"script": [
						"runtime.objects.Rules.getFirstInstance().setJsonDataCopy(rules)"
					],
					"disabled": true
				},
				{
					"id": "parse",
					"objectClass": "Rules",
					"sid": 623493135682020,
					"parameters": {
						"data": "rulesJS"
					}
				},
				{
					"type": "comment",
					"text": "Initialize probability tables"
				},
				{
					"id": "createProbabilityTableFromJSON",
					"objectClass": "AdvancedRandom",
					"sid": 522703065808419,
					"parameters": {
						"name": "PT_Enemies",
						"json": "Rules.GetAsCompactString(KEY_Pools & DOT & KEY_Enemies)"
					}
				},
				{
					"id": "createProbabilityTableFromJSON",
					"objectClass": "AdvancedRandom",
					"sid": 621677751769992,
					"parameters": {
						"name": "PT_Upgrades",
						"json": "Rules.GetAsCompactString(KEY_Pools & DOT & KEY_Upgrades)"
					}
				},
				{
					"id": "createProbabilityTableFromJSON",
					"objectClass": "AdvancedRandom",
					"sid": 108957093600224,
					"parameters": {
						"name": "PT_Items",
						"json": "Rules.GetAsCompactString(KEY_Pools & DOT & KEY_Items)"
					}
				},
				{
					"type": "comment",
					"text": "Initialize stuff"
				},
				{
					"id": "set-collision-cell-size",
					"objectClass": "System",
					"sid": 526181492720689,
					"parameters": {
						"width": "64",
						"height": "64"
					}
				},
				{
					"type": "comment",
					"text": "todo remove ground or add texture"
				},
				{
					"type": "comment",
					"text": "Spawn ground"
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 538242720749825,
					"disabled": true,
					"parameters": {
						"object-to-create": "Ground",
						"layer": "LAYER_Main",
						"x": "0",
						"y": "0",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Ground",
					"sid": 853634657343832,
					"disabled": true,
					"parameters": {
						"width": "LayoutWidth",
						"height": "LayoutHeight"
					}
				},
				{
					"id": "move-to-bottom",
					"objectClass": "Ground",
					"sid": 666911253684500,
					"disabled": true
				},
				{
					"type": "comment",
					"text": "Spawn walls"
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 436165884098190,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "LayoutWidth * 0.5",
						"y": "- C_Wall_Thickness * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 372164925536138,
					"parameters": {
						"width": "LayoutWidth + C_Wall_Thickness * 2",
						"height": "C_Wall_Thickness"
					}
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 584770231200107,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "LayoutWidth * 0.5",
						"y": "LayoutHeight + C_Wall_Thickness * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 937618882365889,
					"parameters": {
						"width": "LayoutWidth + C_Wall_Thickness * 2",
						"height": "C_Wall_Thickness"
					}
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 240353864337880,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "- C_Wall_Thickness * 0.5",
						"y": "LayoutHeight * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 165370721943898,
					"parameters": {
						"width": "C_Wall_Thickness",
						"height": "LayoutHeight + C_Wall_Thickness * 2"
					}
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 862702925551168,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "LayoutWidth + C_Wall_Thickness * 0.5",
						"y": "LayoutHeight * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 105567992232093,
					"parameters": {
						"width": "C_Wall_Thickness",
						"height": "LayoutHeight + C_Wall_Thickness * 2"
					}
				},
				{
					"type": "comment",
					"text": "Spawn ground map & player"
				},
				{
					"customAction": "spawn",
					"objectClass": "Map",
					"sid": 808457871185290
				},
				{
					"customAction": "spawn",
					"objectClass": "Player",
					"sid": 608803642935295
				},
				{
					"type": "comment",
					"text": "Initalize UI"
				},
				{
					"id": "set-instvar-value",
					"objectClass": "UI_Bar_Health",
					"sid": 499149326416057,
					"parameters": {
						"instance-variable": "initWidth",
						"value": "Self.Width"
					}
				},
				{
					"id": "set-instvar-value",
					"objectClass": "UI_Bar_Experience",
					"sid": 391170858286368,
					"parameters": {
						"instance-variable": "initWidth",
						"value": "Self.Width"
					}
				},
				{
					"id": "set-width",
					"objectClass": "UI_Bar_Experience",
					"sid": 380181524179996,
					"parameters": {
						"width": "0"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "UI_Vignette9P",
					"sid": 273375704844316,
					"parameters": {
						"opacity": "0"
					}
				}
			],
			"sid": 448800525830597
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "every-tick",
					"objectClass": "System",
					"sid": 823011474147348
				},
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 694647922651802,
					"parameters": {
						"variable": "isPaused",
						"comparison": 0,
						"value": "NO"
					}
				}
			],
			"actions": [
				{
					"id": "set-text",
					"objectClass": "UI_TextSF_Devlog",
					"sid": 441293905551017,
					"parameters": {
						"text": "round(fps) & \" FPS, \" & objectcount & \" objects, \" & Enemy.Count & \" enemies, \" & Weapon.Count & \" weapon sprites\" & newline &\n\"Enemy spawn cooldown bonus: \" & Rules.Get(KEY_Player & DOT & KEY_Bonus_Enemy_Spawn_Cooldown_Multiplier) * 100 & \"%\" & newline &\n\"Item spawn cooldown bonus: \" & Rules.Get(KEY_Player & DOT & KEY_Bonus_Item_Spawn_Cooldown_Multiplier) * 100 & \"%\" & newline &\n\"XP gain bonus: \" & Rules.Get(KEY_Player & DOT & KEY_Bonus_Experience_Multiplier) * 100 & \"%\" & newline &\n\"Weapon cooldown bonus: \" & Rules.Get(KEY_Player & DOT & KEY_Bonus_Weapon_Cooldown_Multiplier) * 100 & \"%\" & newline &\n\"Weapon damage bonus: \" & Rules.Get(KEY_Player & DOT & KEY_Bonus_Weapon_Damage_Multiplier) * 100 & \"%\" & newline &\n\"Weapon size bonus: \" & Rules.Get(KEY_Player & DOT & KEY_Bonus_Weapon_Size_Multiplier) * 100 & \"%\" & newline &\n\"Weapon amount bonus: +\" & Rules.Get(KEY_Player & DOT & KEY_Bonus_Weapon_Amount_Extra) & newline\n"
					}
				},
				{
					"type": "comment",
					"text": "Update experience bar & text"
				},
				{
					"id": "set-width",
					"objectClass": "UI_Bar_Experience",
					"sid": 837565277708013,
					"parameters": {
						"width": "lerp(Self.Width, min(Player.experience / Rules.Get(KEY_Player & DOT & KEY_Experience_Target) * Self.initWidth, Self.initWidth), 0.1)"
					}
				},
				{
					"id": "set-text",
					"objectClass": "UI_TextSF_Experience",
					"sid": 327795640325862,
					"parameters": {
						"text": "Player.experience & \" / \" & Rules.Get(KEY_Player & DOT & KEY_Experience_Target) & newline & KEY_Experience"
					}
				},
				{
					"type": "comment",
					"text": "Update health bar & text"
				},
				{
					"id": "set-width",
					"objectClass": "UI_Bar_Health",
					"sid": 573386309651650,
					"parameters": {
						"width": "lerp(Self.Width, min(Rules.Get(KEY_Player & DOT & KEY_Health) / Rules.Get(KEY_Player & DOT & KEY_Health_Max) * Self.initWidth, Self.initWidth), 0.1)"
					}
				},
				{
					"id": "set-text",
					"objectClass": "UI_TextSF_Health",
					"sid": 591907075046490,
					"parameters": {
						"text": "KEY_Health & newline & round(Rules.Get(KEY_Player & DOT & KEY_Health)) & \" / \" & round(Rules.Get(KEY_Player & DOT & KEY_Health_Max))"
					}
				},
				{
					"type": "comment",
					"text": "Tick player"
				},
				{
					"customAction": "tick",
					"objectClass": "Player",
					"sid": 451834143784264
				},
				{
					"type": "comment",
					"text": "Spawn an enemy from queue (if needed)"
				},
				{
					"customAction": "spawnFromQueue",
					"objectClass": "Enemy",
					"sid": 569763485951453
				},
				{
					"type": "comment",
					"text": "Tick enemies"
				},
				{
					"customAction": "tick",
					"objectClass": "Enemy",
					"sid": 584880034086273
				},
				{
					"type": "comment",
					"text": "Update damage number scales"
				},
				{
					"id": "set-scale",
					"objectClass": "UI_TextSF_DamageNumber",
					"sid": 603707266467517,
					"parameters": {
						"scale": "Self.Tween.Value(TWEEN_UI_TextSF_DamageNumber_Scale) = 0 ? Self.CharacterScale : Self.Tween.Value(TWEEN_UI_TextSF_DamageNumber_Scale)"
					}
				},
				{
					"type": "comment",
					"text": "Update vignette opacity"
				},
				{
					"id": "set-opacity",
					"objectClass": "UI_Vignette9P",
					"sid": 134933458583808,
					"parameters": {
						"opacity": "lerp(Self.Opacity, Player.isHurt = YES ? 100 : 0, 0.2)"
					}
				},
				{
					"type": "comment",
					"text": "Update drop movement angles (towards player)"
				},
				{
					"id": "set-angle-of-motion",
					"objectClass": "Drop",
					"sid": 335552295184695,
					"behaviorType": "Bullet",
					"parameters": {
						"angle": "angle(Self.X, Self.Y, Player.X, Player.Y)"
					}
				},
				{
					"type": "comment",
					"text": "Update arrows"
				},
				{
					"id": "set-angle-toward-position",
					"objectClass": "Arrow",
					"sid": 772696613266894,
					"parameters": {
						"x": "Self.itemX",
						"y": "Self.itemY"
					}
				},
				{
					"id": "set-position",
					"objectClass": "Arrow",
					"sid": 880305685323650,
					"parameters": {
						"x": "Player.X",
						"y": "Player.Y"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "Arrow",
					"sid": 381940989544921,
					"parameters": {
						"opacity": "lerp(Self.Opacity, distance(Player.X, Player.Y, Self.itemX, Self.itemY) < min(ViewportMidX(LAYER_UI), ViewportMidY(LAYER_UI)) ? 0 : C_Arrow_Opacity, 0.1)"
					}
				}
			],
			"sid": 191789492098499
		}
	],
	"sid": 488420928527336
}