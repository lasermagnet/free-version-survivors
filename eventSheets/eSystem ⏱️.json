{
	"name": "eSystem ⏱️",
	"events": [
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-start-of-layout",
					"objectClass": "System",
					"sid": 973691923966273
				}
			],
			"actions": [
				{
					"type": "comment",
					"text": "Load rules from JSON"
				},
				{
					"id": "parse",
					"objectClass": "Rules",
					"sid": 623493135682020,
					"parameters": {
						"data": "rulesJSON"
					}
				},
				{
					"type": "comment",
					"text": "Initialize upgrade pool"
				},
				{
					"id": "createProbabilityTableFromJSON",
					"objectClass": "AdvancedRandom",
					"sid": 499067768398314,
					"parameters": {
						"name": "PT_Upgrades",
						"json": "Rules.GetAsCompactString(KEY_Level & DOT & KEY_UpgradePool)"
					}
				},
				{
					"type": "comment",
					"text": "Set up collision cell size"
				},
				{
					"id": "set-collision-cell-size",
					"objectClass": "System",
					"sid": 526181492720689,
					"parameters": {
						"width": "64",
						"height": "64"
					}
				},
				{
					"type": "comment",
					"text": "Spawn ground texture"
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 538242720749825,
					"parameters": {
						"object-to-create": "Ground",
						"layer": "LAYER_Main",
						"x": "0",
						"y": "0",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Ground",
					"sid": 469358774110512,
					"parameters": {
						"width": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width)",
						"height": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height)"
					}
				},
				{
					"id": "move-to-bottom",
					"objectClass": "Ground",
					"sid": 666911253684500
				},
				{
					"type": "comment",
					"text": "Spawn four level bounding walls"
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 459577338062875,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width) * 0.5",
						"y": "- Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 636851058154223,
					"parameters": {
						"width": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width) + Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 2",
						"height": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness)"
					}
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 810193117346646,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width) * 0.5",
						"y": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height) + Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 132560252477310,
					"parameters": {
						"width": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width) + Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 2",
						"height": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness)"
					}
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 490780749574257,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "- Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 0.5",
						"y": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height) * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 805807832897666,
					"parameters": {
						"width": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness)",
						"height": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height) + Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 2"
					}
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 871994874644437,
					"parameters": {
						"object-to-create": "Wall",
						"layer": "LAYER_Main",
						"x": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width) + Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 0.5",
						"y": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height) * 0.5",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Wall",
					"sid": 438529320865827,
					"parameters": {
						"width": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness)",
						"height": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height) + Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_WallThickness) * 2"
					}
				},
				{
					"type": "comment",
					"text": "Spawn level tilemap and add decorations"
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 650414608895846,
					"parameters": {
						"object-to-create": "Map",
						"layer": "LAYER_Main",
						"x": "0",
						"y": "0",
						"create-hierarchy": false,
						"template-name": "\"\""
					}
				},
				{
					"id": "set-size",
					"objectClass": "Map",
					"sid": 958698470524460,
					"parameters": {
						"width": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width)",
						"height": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height)"
					}
				},
				{
					"id": "erase-tile-range",
					"objectClass": "Map",
					"sid": 191380699385691,
					"parameters": {
						"tile-x": "0",
						"tile-y": "0",
						"width": "Self.MapDisplayWidth",
						"height": "Self.MapDisplayHeight"
					}
				},
				{
					"customAction": "addDecorations",
					"objectClass": "Map",
					"sid": 808457871185290
				},
				{
					"type": "comment",
					"text": "Spawn player"
				},
				{
					"id": "create-object",
					"objectClass": "System",
					"sid": 221635225319954,
					"parameters": {
						"object-to-create": "Player",
						"layer": "LAYER_Main",
						"x": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Width) * 0.5",
						"y": "Rules.Get(KEY_Level & DOT & KEY_Map & DOT & KEY_Height) * 0.5",
						"create-hierarchy": true,
						"template-name": "\"\""
					}
				},
				{
					"type": "comment",
					"text": "Disable physics gravity"
				},
				{
					"id": "set-world-gravity",
					"objectClass": "Player",
					"sid": 776809560545526,
					"behaviorType": "Physics",
					"parameters": {
						"gravity": "0"
					}
				},
				{
					"type": "comment",
					"text": "Set player's movement speed"
				},
				{
					"id": "set-max-speed",
					"objectClass": "Player",
					"sid": 316291171629907,
					"behaviorType": "8Direction",
					"parameters": {
						"max-speed": "Rules.Get(KEY_Player & DOT & KEY_MovementSpeed)"
					}
				},
				{
					"type": "comment",
					"text": "Initalize UI"
				},
				{
					"id": "set-instvar-value",
					"objectClass": "UI_Bar_Experience",
					"sid": 391170858286368,
					"parameters": {
						"instance-variable": "initWidth",
						"value": "Self.Width"
					}
				},
				{
					"id": "set-width",
					"objectClass": "UI_Bar_Experience",
					"sid": 380181524179996,
					"parameters": {
						"width": "0"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "UI_Vignette9P",
					"sid": 273375704844316,
					"parameters": {
						"opacity": "0"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "UI_TextSF_Stats",
					"sid": 881795499284109,
					"parameters": {
						"opacity": "0"
					}
				}
			],
			"sid": 448800525830597
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "every-tick",
					"objectClass": "System",
					"sid": 698811962908702
				},
				{
					"id": "compare-eventvar",
					"objectClass": "System",
					"sid": 243781292392919,
					"parameters": {
						"variable": "isPaused",
						"comparison": 0,
						"value": "NO"
					}
				}
			],
			"actions": [
				{
					"type": "comment",
					"text": "Update devinfo UI"
				},
				{
					"id": "set-text",
					"objectClass": "UI_TextSF_DevInfo",
					"sid": 835607645774821,
					"parameters": {
						"text": "\"Build \" & projectversion & newline &\nStringSub(\"{0} FPS, {1}% CPU, {2}% GPU, {3} objects, {4} enemies\", fps, round(cpuutilisation * 100), round(gpuutilisation * 100), objectcount, Enemy.Count)\n"
					}
				},
				{
					"type": "comment",
					"text": "Update time UI"
				},
				{
					"id": "set-text",
					"objectClass": "UI_TextSF_Time",
					"sid": 801658922532501,
					"parameters": {
						"text": "(timePassed / 3600 >= 1 ? int(timePassed / 3600) & \":\" : \"\") & zeropad(int(timePassed / 60), 2) & \":\" & zeropad((int(timePassed) % 60), 2)"
					}
				},
				{
					"type": "comment",
					"text": "Update player level UI"
				},
				{
					"id": "set-text",
					"objectClass": "UI_TextSF_Level",
					"sid": 658624073574158,
					"parameters": {
						"text": "\"LVL \" & Player.level"
					}
				},
				{
					"type": "comment",
					"text": "Tick player"
				},
				{
					"customAction": "tick",
					"objectClass": "Player",
					"sid": 665667490718525
				},
				{
					"type": "comment",
					"text": "Spawn an enemy from queue (if needed) & subtract one from spawn queue"
				},
				{
					"customAction": "spawn",
					"objectClass": "Enemy",
					"sid": 872104649170109,
					"parameters": [
						"EMPTY",
						"enemySpawnQueue > 0 & Rules.ArraySize(KEY_Waves & DOT & waveId & DOT & KEY_EnemySpawnPool) > 0 ? 1 : 0"
					]
				},
				{
					"id": "set-eventvar-value",
					"objectClass": "System",
					"sid": 822665144799972,
					"parameters": {
						"variable": "enemySpawnQueue",
						"value": "max(0, enemySpawnQueue - 1)"
					}
				},
				{
					"type": "comment",
					"text": "Tick enemies"
				},
				{
					"customAction": "tick",
					"objectClass": "Enemy",
					"sid": 776456162115713
				},
				{
					"type": "comment",
					"text": "Update damage number scales"
				},
				{
					"id": "set-scale",
					"objectClass": "UI_TextSF_Damage",
					"sid": 877494270097599,
					"parameters": {
						"scale": "Self.Tween.Value(TWEEN_UI_TextSF_DamageNumber_Scale) = 0 ? Self.CharacterScale : Self.Tween.Value(TWEEN_UI_TextSF_DamageNumber_Scale)"
					}
				},
				{
					"type": "comment",
					"text": "Update vignette opacity according to the \"is hurt\" state of the player"
				},
				{
					"id": "set-opacity",
					"objectClass": "UI_Vignette9P",
					"sid": 113435045110058,
					"parameters": {
						"opacity": "lerp(Self.Opacity, Player.isHurt = YES ? 100 : 0, 0.2)"
					}
				},
				{
					"type": "comment",
					"text": "Update player particle rate according to the \"is hurt\" state of the player"
				},
				{
					"id": "set-rate",
					"objectClass": "PlayerParticles",
					"sid": 910576062455164,
					"parameters": {
						"rate": "Player.isHurt = YES & Player.isDead = NO ? C_Particle_Rate_Hurting : 0"
					}
				},
				{
					"type": "comment",
					"text": "Update drop movement angles (towards player)"
				},
				{
					"id": "set-angle-of-motion",
					"objectClass": "Drop",
					"sid": 520741996802467,
					"behaviorType": "Bullet",
					"parameters": {
						"angle": "angle(Self.X, Self.Y, Player.X, Player.Y)"
					}
				},
				{
					"type": "comment",
					"text": "Update arrows"
				},
				{
					"id": "set-angle-toward-position",
					"objectClass": "Arrow",
					"sid": 412701711563759,
					"parameters": {
						"x": "Self.itemX",
						"y": "Self.itemY"
					}
				},
				{
					"id": "set-position",
					"objectClass": "Arrow",
					"sid": 173390875794393,
					"parameters": {
						"x": "Player.X",
						"y": "Player.Y"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "Arrow",
					"sid": 310423212452665,
					"parameters": {
						"opacity": "lerp(Self.Opacity, distance(Player.X, Player.Y, Self.itemX, Self.itemY) < min(ViewportMidX(LAYER_UI), ViewportMidY(LAYER_UI)) ? 0 : C_Arrow_Opacity, 0.2)"
					}
				},
				{
					"type": "comment",
					"text": "Update experience bar"
				},
				{
					"id": "set-width",
					"objectClass": "UI_Bar_Experience",
					"sid": 371634801953482,
					"parameters": {
						"width": "lerp(Self.Width, min(Rules.Get(KEY_Player & DOT & KEY_Experience) / Rules.Get(KEY_Player & DOT & KEY_Experience_Target) * Self.initWidth, Self.initWidth), 0.2)"
					}
				},
				{
					"type": "comment",
					"text": "Update health bar"
				},
				{
					"id": "set-width",
					"objectClass": "UI_Bar_Health",
					"sid": 875849611035759,
					"parameters": {
						"width": "lerp(Self.Width, min(Rules.Get(KEY_Player & DOT & KEY_Health) / Rules.Get(KEY_Player & DOT & KEY_Health_Max) * Self.initWidth, Self.initWidth), 0.1)"
					}
				},
				{
					"type": "comment",
					"text": "Update Z orders"
				},
				{
					"id": "move-to-bottom",
					"objectClass": "Drop",
					"sid": 185420096314904
				},
				{
					"id": "move-to-top",
					"objectClass": "Enemy",
					"sid": 531046539279743
				},
				{
					"id": "move-to-top",
					"objectClass": "Weapon",
					"sid": 354509360787089
				},
				{
					"id": "move-to-top",
					"objectClass": "Arrow",
					"sid": 258838286228098
				},
				{
					"id": "move-to-top",
					"objectClass": "Player",
					"sid": 531655831829064
				},
				{
					"id": "move-to-top",
					"objectClass": "PlayerParticles",
					"sid": 625900676522550
				},
				{
					"id": "move-to-top",
					"objectClass": "UI_TextSF_Damage",
					"sid": 595605090066452
				},
				{
					"id": "move-to-top",
					"objectClass": "UI_Bar_Health",
					"sid": 704298874778693
				}
			],
			"sid": 153988922630664
		}
	],
	"sid": 488420928527336
}